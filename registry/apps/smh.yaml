# valet version 0.4.1
name: service-mesh-hub
requiredValues:
  - Version
  - ClusterName
  - AwsCredentialsFile
values:
  Namespace: sm-marketplace
  MeshProjectsEnabled: true
  ApiServerDisabled: false
resources:
  - namespace:
      name: sm-marketplace
  - secret:
      name: github-token
      entries:
        token:
          envVar: GITHUB_TOKEN
  - secret:
      name: aws-cred
      entries:
        credentials:
          file: "{{ .AwsCredentialsFile }}"
  - secret:
      name: remote-kube-config
      type: solo.io/kubeconfig
      entries:
        "{{ .ClusterName }}":
          file: $HOME/.kube/eksctl/clusters/{{ .ClusterName }}
  - helmChart:
      repoUrl: "https://storage.googleapis.com/sm-marketplace-helm/"
      chartName: sm-marketplace
      repoName: sm-marketplace
      values:
        "meshProjects.enabled": "template:{{ .MeshProjectsEnabled }}"
        "apiserver.disabled": "template:{{ .ApiServerDisabled }}"
      set:
        - "namespace.create=true"