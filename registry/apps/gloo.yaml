# Sets up all the resources for Gloo enterprise

name: gloo-enterprise
version: 0.20.4
namespace: gloo-system
values:
  Domain: valet-testing-glooui.corp.solo.io
  UpstreamName: gloo-system-apiserver-ui-8080
  UpstreamNamespace: gloo-system
  VirtualServiceName: glooui
resources:
  # NOTE: currently, grafana / prometheus are disabled because reapplying causes an error
  - helmChart:
      repoUrl: "https://storage.googleapis.com/gloo-ee-helm/"
      chartName: gloo-ee
      repoName: gloo-ee
      set:
        - "gloo.namespace.create=true"
        - "prometheus.enabled=false"
        - "grafana.defaultInstallationEnabled=false"
        - "gloo.gatewayProxies.gatewayProxyV2.readConfig=true"
      setEnv:
        license_key: LICENSE_KEY

  # Set up DNS and a cert for https
  - template:
      path: registry/templates/cert.yaml
  - dnsEntry:
      hostedZone: corp.solo.io.
      service:
        namespace: gloo-system
        name: gateway-proxy-v2
  - template:
      path: registry/templates/virtual-service-ssl.yaml

# TODO: Set up oauth correctly
#      - secret:
#          name: google
#          namespace: gloo-system
#          entries:
#            client_secret:
#              envVar: GOOGLE_CLIENT_SECRET
#      - template:
#          path: config/templates/google_oauth.yaml
#          values:
#            Domain: valet-testing-glooui.corp.solo.io