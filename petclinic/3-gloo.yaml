# Sets up all the resources for Gloo enterprise

name: gloo-enterprise
version: 0.20.4
values:
  Domain: valet-testing-glooui.corp.solo.io
  UpstreamName: gloo-system-apiserver-ui-8080
  UpstreamNamespace: gloo-system
  VirtualServiceName: glooui
resources:
  # NOTE: currently, grafana / prometheus are disabled because reapplying causes an error
  - helmChart:
      repoUrl: "https://storage.googleapis.com/gloo-ee-helm/"
      chartName: gloo-ee
      repoName: gloo-ee
      set:
        - "gloo.namespace.create=true"
        - "prometheus.enabled=false"
        - "grafana.defaultInstallationEnabled=false"
        - "gloo.gatewayProxies.gatewayProxyV2.readConfig=true"
      setEnv:
        license_key: LICENSE_KEY

  - secret:
      name: aws-creds
      namespace: gloo-system
      entries:
        aws_access_key_id:
          envVar: AWS_ACCESS_KEY_ID
        aws_secret_access_key:
          envVar: AWS_SECRET_ACCESS_KEY

  - path: registry/files/aws-upstream.yaml

  # Set up DNS and a cert for https
  - template:
      path: registry/templates/cert.yaml
  - dnsEntry:
      subdomain: valet-testing-glooui
      hostedZone: corp.solo.io.
      service:
        namespace: gloo-system
        name: gateway-proxy-v2
  - template:
      path: registry/templates/virtual-service-ssl.yaml
